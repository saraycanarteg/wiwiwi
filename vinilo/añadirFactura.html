<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nueva Factura - Sistema de Facturaci√≥n</title>
	<link rel="stylesheet" href="styleBill/estilo2.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <img src="img/logo.png" alt="Logo" id="logo-img">
            <span style="font-weight: bold; color: #F87154;">Define Records</span>
        </div>
        <nav class="nav">
            <a href="sesion.html" class="nav-link">Inicio</a>
            <a href="inventario.html" class="nav-link">Inventario</a>
            <a href="factura.html" class="nav-link">Facturas</a>
            <a href="#" class="nav-link">Ayuda</a>
            <button class="account-btn" onclick="openAccountModal()">Mi Cuenta</button>
        </nav>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Title Section -->
        <div class="title-section">
            <h1>Nueva Factura</h1>
        </div>

        <!-- Back Button -->
        <button class="back-button" onclick="window.location.href='factura.html'">
            <span>‚Üê</span>
            Volver al Listado
        </button>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <span>‚úÖ</span>
            <span>Factura creada exitosamente</span>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <form id="invoiceForm">
                <!-- Invoice Data -->
                <div class="form-section">
                    <h3>
                        <span>üìÑ</span>
                        Datos de la Factura
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="invoice-number">N√∫mero de Factura *</label>
                            <input type="text" id="invoice-number" name="invoice-number" readonly>
                        </div>
                        <div class="form-group">
                            <label for="invoice-date">Fecha de Emisi√≥n *</label>
                            <input type="date" id="invoice-date" name="invoice-date" required>
                        </div>
                        <div class="form-group">
                            <label for="due-date">Fecha de Vencimiento</label>
                            <input type="date" id="due-date" name="due-date">
                        </div>
                        <div class="form-group">
                            <label for="payment-method">M√©todo de Pago</label>
                            <select id="payment-method" name="payment-method">
                                <option value="efectivo">Efectivo</option>
                                <option value="tarjeta">Tarjeta</option>
                                <option value="transferencia">Transferencia</option>
                                <option value="cheque">Cheque</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Client Information -->
                <div class="form-section">
                    <h3>
                        <span>üë§</span>
                        Informaci√≥n del Cliente
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="client-name">Nombre/Raz√≥n Social *</label>
                            <input type="text" id="client-name" name="client-name" placeholder="Nombre del cliente" required>
                        </div>
                        <div class="form-group">
                            <label for="client-document">RUC/C√©dula</label>
                            <input type="text" id="client-document" name="client-document" placeholder="Documento de identificaci√≥n">
                        </div>
                        <div class="form-group">
                            <label for="client-email">Email</label>
                            <input type="email" id="client-email" name="client-email" placeholder="cliente@email.com">
                        </div>
                        <div class="form-group">
                            <label for="client-phone">Tel√©fono</label>
                            <input type="tel" id="client-phone" name="client-phone" placeholder="Tel√©fono del cliente">
                        </div>
                        <div class="form-group">
                            <label for="client-address">Direcci√≥n</label>
                            <input type="text" id="client-address" name="client-address" placeholder="Direcci√≥n del cliente">
                        </div>
                    </div>
                </div>

                <!-- Items Section -->
                <div class="form-section">
                    <h3>
                        <span>üì¶</span>
                        Detalles de Items
                    </h3>
                    <div class="items-section">
                        <div class="items-header">
                            <h4>Lista de Productos/Servicios</h4>
                            <button type="button" class="add-item-btn" onclick="addItem()">
                                <span>+</span>
                                Agregar Item
                            </button>
                        </div>
                        <div id="items-container">
                            <div class="item-row">
                                <div class="form-group">
                                    <label>Producto/Servicio *</label>
                                    <select name="item-product" onchange="updateItemDetails(this)" required>
                                        <option value="">Seleccionar producto...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Cantidad *</label>
                                    <input type="number" name="item-quantity" min="1" value="1" onchange="calculateTotal()" required>
                                </div>
                                <div class="form-group">
                                    <label>Precio Unitario *</label>
                                    <input type="number" name="item-price" step="0.01" min="0" onchange="calculateTotal()" placeholder="0.00" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Total</label>
                                    <input type="number" name="item-total" step="0.01" readonly>
                                </div>
                                <div class="form-group">
                                    <button type="button" class="remove-item-btn" onclick="removeItem(this)" title="Eliminar item">
                                        <span>üóë</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
					
                    <!-- Totals Section -->
                    <div class="totals-section">
                        <div class="totals-grid">
                            <div class="total-item">
                                <label>Subtotal</label>
                                <div class="total-amount" id="subtotal">$0.00</div>
                            </div>
                            <div class="total-item">
                                <label>IVA (12%)</label>
                                <div class="total-amount" id="tax">$0.00</div>
                            </div>
                            <div class="total-item">
                                <label>Descuento</label>
                                <input type="number" class="discount-input" id="discount" step="0.01" min="0" value="0" onchange="calculateTotal()" placeholder="0.00">
                            </div>
                            <div class="total-item">
                                <label>TOTAL A PAGAR</label>
                                <div class="final-total" id="final-total">$0.00</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 25px;">
                        <label for="notes">Observaciones</label>
                        <textarea id="notes" name="notes" rows="4" placeholder="T√©rminos y condiciones, observaciones adicionales, forma de pago..."></textarea>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <span id="save-text">üíæ Guardar Factura</span>
                        <div class="loading" id="loading">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="previewInvoice()">
                        üëÅ Previsualizar
                    </button>
                    <button type="button" class="btn btn-outline" onclick="printInvoice()">
                        üñ® Imprimir
                    </button>
                    <button type="reset" class="btn btn-outline" onclick="resetForm()">
                        üîÑ Limpiar Formulario
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Define Records</h3>
                <p>Tu tienda especializada en vinilos con m√°s de 20 a√±os de experiencia. Encuentra desde cl√°sicos atemporales hasta las √∫ltimas novedades del mundo musical.</p>
              </div>
            
            <div class="footer-section">
                <h3>Contacto</h3>
                <p>üìç Calle de la M√∫sica 123, Centro Hist√≥rico</p>
                <p>üìû +593 98 765 4321</p>
                <p>‚úâÔ∏è info@definerecords.com</p>
                <p>üïí Lun - S√°b: 10:00 - 20:00</p>
                <p>üïí Dom: 12:00 - 18:00</p>
            </div>
            
            <div class="footer-section">
                <h3>Categor√≠as</h3>
                <a href="#">Rock & Pop</a>
                <a href="#">Jazz & Blues</a>
                <a href="#">Electr√≥nica</a>
                <a href="#">Hip Hop & R&B</a>
                <a href="#">M√∫sica Latina</a>
                <a href="#">Cl√°sica</a>
                <a href="#">Ediciones Especiales</a>
            </div>
            
            <div class="footer-section">
                <h3>Servicios</h3>
                <a href="#">Gesti√≥n de Inventario</a>
                <a href="#">Facturaci√≥n Digital</a>
                <a href="#">B√∫squeda Avanzada</a>
                <a href="#">Reservas Online</a>
                <a href="#">Intercambio de Vinilos</a>
                <a href="#">Valoraciones</a>
                <a href="#">Soporte T√©cnico</a>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 Define Records. Todos los derechos reservados. | Sistema de gesti√≥n desarrollado con ‚ù§Ô∏è para los amantes de la m√∫sica anal√≥gica.</p>
        </div>
    </footer>
	
   <!-- Account Modal -->
    <div class="modal-overlay" id="accountModal">
        <div class="account-container">
            <button class="close-btn" onclick="closeAccountModal()">&times;</button>
            
            <img src="img/fpf.png" alt="Foto de perfil" class="profile-picture">
            
            <h2 class="account-title">Mi Cuenta</h2>
            
            <div class="account-info">
                <div class="info-item">
                    <span class="info-label">Usuario:</span>
                    <span class="info-value">admin</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Nombre:</span>
                    <span class="info-value">Saray Canarte</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Rol:</span>
                    <span class="info-value">Administrador</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Email:</span>
                    <span class="info-value">saray@definerecords.com</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Estado:</span>
                    <span class="status-badge">Activo</span>
                </div>
                <div class="info-item">
                    <span class="info-label">√öltimo acceso:</span>
                    <span class="info-value">Hoy, 14:30</span>
                </div>
            </div>
			<button class="logout-btn" onclick="logoutUser()">
                Cerrar Sesi√≥n
            </button>
        </div>
    </div>

    <script>
		let vinyls = [
			{ id: 1, album: "Dark Side of the Moon", artist: "Pink Floyd", genre: "Rock", year: 1973, price: 45.99, stock: 2, icon: "üåô" },
			{ id: 2, album: "Thriller", artist: "Michael Jackson", genre: "Pop", year: 1982, price: 38.99, stock: 0, icon: "üëª" },
			{ id: 3, album: "Kind of Blue", artist: "Miles Davis", genre: "Jazz", year: 1959, price: 51.99, stock: 1, icon: "üé∫" }
		];
		
		function populateSelectOptions(selectElement) {
			selectElement.innerHTML = '<option value="">Seleccionar producto...</option>'; // Reiniciar

			vinyls.forEach(v => {
				if (v.stock > 0) {
					const option = document.createElement("option");
					option.value = v.id;
					option.textContent = `${v.icon} ${v.album} - ${v.artist} (${v.year})`;
					option.setAttribute("data-price", v.price);
					selectElement.appendChild(option);
				}
			});
		}
		window.onload = function () {
			const firstSelect = document.querySelector('select[name="item-product"]');
			populateSelectOptions(firstSelect);
		};

        // Funciones para el modal de cuenta
        function openAccountModal() {
            document.getElementById('accountModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeAccountModal() {
            document.getElementById('accountModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Cerrar modal al hacer click fuera de √©l
        document.getElementById('accountModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAccountModal();
            }
        });

        // Cerrar modal con tecla Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && document.getElementById('accountModal').classList.contains('active')) {
                closeAccountModal();
            }
        });
		
		function logoutUser() {
            // Confirmar cierre de sesi√≥n
            if (confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?')) {
                // Mostrar mensaje de confirmaci√≥n
                alert('Sesi√≥n cerrada exitosamente. ¬°Hasta pronto!');
                
                // Cerrar el modal
                closeAccountModal();
                
                // Opcional: Redirigir a p√°gina de login o recargar
                window.location.href = 'index.html';
                // O simplemente recargar la p√°gina actual
                
            }
        }

        // Cerrar modal al hacer click fuera de √©l
        document.getElementById('accountModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAccountModal();
            }
        });

        // Cerrar modal con tecla Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && document.getElementById('accountModal').classList.contains('active')) {
                closeAccountModal();
            }
        });
		
        let invoiceCounter = 1;
        let invoices = JSON.parse(localStorage.getItem('invoices') || '[]');

        // Initialize form
        function initializeForm() {
            // Set invoice number
            const nextNumber = String(invoices.length + 1).padStart(5, '0');
            document.getElementById('invoice-number').value = 'FAC-' + nextNumber;
            
            // Set current date
            document.getElementById('invoice-date').value = new Date().toISOString().split('T')[0];
            
            // Set due date (30 days from now)
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            document.getElementById('due-date').value = dueDate.toISOString().split('T')[0];
            
            calculateTotal();
        }

        // Item management
		function addItem() {
			const container = document.getElementById('items-container');
			const newItem = document.createElement('div');
			newItem.className = 'item-row';
			newItem.innerHTML = `
				<div class="form-group">
					<label>Producto/Servicio *</label>
					<select name="item-product" onchange="updateItemDetails(this)" required>
						<option value="">Seleccionar producto...</option>
					</select>
				</div>
				<div class="form-group">
					<label>Cantidad *</label>
					<input type="number" name="item-quantity" min="1" value="1" onchange="calculateTotal()" required>
				</div>
				<div class="form-group">
					<label>Precio Unitario *</label>
					<input type="number" name="item-price" step="0.01" min="0" onchange="calculateTotal()" placeholder="0.00" readonly>
				</div>
				<div class="form-group">
					<label>Total</label>
					<input type="number" name="item-total" step="0.01" readonly>
				</div>
				<div class="form-group">
					<button type="button" class="remove-item-btn" onclick="removeItem(this)" title="Eliminar item">
						<span>üóë</span>
					</button>
				</div>
			`;

			container.appendChild(newItem);

			// Rellenar el select del nuevo item
			const select = newItem.querySelector('select[name="item-product"]');
			populateSelectOptions(select);
		}
		
		function updateItemDetails(selectElement) {
			const selectedOption = selectElement.options[selectElement.selectedIndex];
			const price = parseFloat(selectedOption.getAttribute('data-price')) || 0;

			const itemRow = selectElement.closest('.item-row');
			const priceInput = itemRow.querySelector('input[name="item-price"]');
			const quantityInput = itemRow.querySelector('input[name="item-quantity"]');
			const totalInput = itemRow.querySelector('input[name="item-total"]');

			priceInput.value = price.toFixed(2);
			const quantity = parseInt(quantityInput.value) || 1;
			totalInput.value = (quantity * price).toFixed(2);
		}

        function calculateTotal() {
            const items = document.querySelectorAll('.item-row');
            let subtotal = 0;

            items.forEach(item => {
                const quantity = parseFloat(item.querySelector('[name="item-quantity"]').value) || 0;
                const price = parseFloat(item.querySelector('[name="item-price"]').value) || 0;
                const total = quantity * price;
                
                item.querySelector('[name="item-total"]').value = total.toFixed(2);
                subtotal += total;
            });

            const discount = parseFloat(document.getElementById('discount').value) || 0;
            const subtotalWithDiscount = subtotal - discount;
            const tax = subtotalWithDiscount * 0.12; // 12% IVA
            const finalTotal = subtotalWithDiscount + tax;

            document.getElementById('subtotal').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('tax').textContent = '$' + tax.toFixed(2);
            document.getElementById('final-total').textContent = '$' + Math.max(0, finalTotal).toFixed(2);
        }

        function previewInvoice() {
            const formData = new FormData(document.getElementById('invoiceForm'));
            const invoiceData = {
                number: formData.get('invoice-number'),
                date: formData.get('invoice-date'),
                company: formData.get('company-name'),
                client: formData.get('client-name'),
                total: document.getElementById('final-total').textContent
            };

            alert(`Vista Previa de Factura:
            
			N√∫mero: ${invoiceData.number}
			Fecha: ${invoiceData.date}
			Empresa: ${invoiceData.company}
			Cliente: ${invoiceData.client}
			Total: ${invoiceData.total}
			`);
					}

        function printInvoice() {
            // En una implementaci√≥n real, aqu√≠ se generar√≠a un PDF o se abrir√≠a la ventana de impresi√≥n
            alert('Funci√≥n de impresi√≥n - En desarrollo. Aqu√≠ se generar√≠a un PDF de la factura.');
        }

        function resetForm() {
            if (confirm('¬øEst√° seguro de que desea limpiar todo el formulario? Se perder√°n todos los datos ingresados.')) {
                document.getElementById('invoiceForm').reset();
                initializeForm();
                
                // Remove extra items, keep only one
                const container = document.getElementById('items-container');
                while (container.children.length > 1) {
                    container.removeChild(container.lastChild);
                }
                
                calculateTotal();
            }
        }

	</script>
	</body>
</html>