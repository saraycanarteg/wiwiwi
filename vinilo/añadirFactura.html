<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nueva Factura - Sistema de Facturaci√≥n</title>
	<link rel="stylesheet" href="styleBill/estilo2.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <img src="img/logo.png" alt="Logo" id="logo-img">
            <span style="font-weight: bold; color: #F87154;">Define Records</span>
        </div>
        <nav class="nav">
            <a href="sesion.html" class="nav-link">Inicio</a>
            <a href="inventario.html" class="nav-link">Inventario</a>
            <a href="factura.html" class="nav-link">Facturas</a>
            <a href="#" class="nav-link">Ayuda</a>
            <button class="account-btn" onclick="openAccountModal()">Mi Cuenta</button>
        </nav>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Title Section -->
        <div class="title-section">
            <h1>Nueva Factura</h1>
        </div>

        <!-- Back Button -->
        <button class="back-button" onclick="window.location.href='factura.html'">
            <span>‚Üê</span>
            Volver al Listado
        </button>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <span>‚úÖ</span>
            <span>Factura creada exitosamente</span>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <form id="invoiceForm">
                <!-- Invoice Data -->
                <div class="form-section">
                    <h3>
                        <span>üìÑ</span>
                        Datos de la Factura
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="invoice-number">N√∫mero de Factura *</label>
                            <input type="text" id="invoice-number" name="invoice-number" readonly>
                        </div>
                        <div class="form-group">
                            <label for="invoice-date">Fecha de Emisi√≥n *</label>
                            <input type="date" id="invoice-date" name="invoice-date" required>
                        </div>
                        <div class="form-group">
                            <label for="due-date">Fecha de Vencimiento</label>
                            <input type="date" id="due-date" name="due-date">
                        </div>
                        <div class="form-group">
                            <label for="payment-method">M√©todo de Pago</label>
                            <select id="payment-method" name="payment-method">
                                <option value="efectivo">Efectivo</option>
                                <option value="tarjeta">Tarjeta</option>
                                <option value="transferencia">Transferencia</option>
                                <option value="cheque">Cheque</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Client Information -->
                <div class="form-section">
                    <h3>
                        <span>üë§</span>
                        Informaci√≥n del Cliente
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="client-name">Nombre/Raz√≥n Social *</label>
                            <input type="text" id="client-name" name="client-name" placeholder="Nombre del cliente" required>
                        </div>
                        <div class="form-group">
                            <label for="client-document">RUC/C√©dula</label>
                            <input type="text" id="client-document" name="client-document" placeholder="Documento de identificaci√≥n">
                        </div>
                        <div class="form-group">
                            <label for="client-email">Email</label>
                            <input type="email" id="client-email" name="client-email" placeholder="cliente@email.com">
                        </div>
                        <div class="form-group">
                            <label for="client-phone">Tel√©fono</label>
                            <input type="tel" id="client-phone" name="client-phone" placeholder="Tel√©fono del cliente">
                        </div>
                        <div class="form-group">
                            <label for="client-address">Direcci√≥n</label>
                            <input type="text" id="client-address" name="client-address" placeholder="Direcci√≥n del cliente">
                        </div>
                    </div>
                </div>

                <!-- Items Section -->
                <div class="form-section">
                    <h3>
                        <span>üì¶</span>
                        Detalles de Items
                    </h3>
                    <div class="items-section">
                        <div class="items-header">
                            <h4>Lista de Productos/Servicios</h4>
                            <button type="button" class="add-item-btn" onclick="addItem()">
                                <span>+</span>
                                Agregar Item
                            </button>
                        </div>
                        <div id="items-container">
                            <div class="item-row">
                                <div class="form-group">
                                    <label>Producto/Servicio *</label>
                                    <select name="item-product" onchange="updateItemDetails(this)" required>
                                        <option value="">Seleccionar producto...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Cantidad *</label>
                                    <input type="number" name="item-quantity" min="1" value="1" onchange="validateStock(this)" required>
                                </div>
                                <div class="form-group">
                                    <label>Precio Unitario *</label>
                                    <input type="number" name="item-price" step="0.01" min="0" onchange="calculateTotal()" placeholder="0.00" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Total</label>
                                    <input type="number" name="item-total" step="0.01" readonly>
                                </div>
                                <div class="form-group">
                                    <button type="button" class="remove-item-btn" onclick="removeItem(this)" title="Eliminar item">
                                        <span>üóë</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
					
                    <!-- Totals Section -->
                    <div class="totals-section">
                        <div class="totals-grid">
                            <div class="total-item">
                                <label>Subtotal</label>
                                <div class="total-amount" id="subtotal">$0.00</div>
                            </div>
                            <div class="total-item">
                                <label>IVA (12%)</label>
                                <div class="total-amount" id="tax">$0.00</div>
                            </div>
                            <div class="total-item">
                                <label>Descuento</label>
                                <input type="number" class="discount-input" id="discount" step="0.01" min="0" value="0" onchange="calculateTotal()" placeholder="0.00">
                            </div>
                            <div class="total-item">
                                <label>TOTAL A PAGAR</label>
                                <div class="final-total" id="final-total">$0.00</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 25px;">
                        <label for="notes">Observaciones</label>
                        <textarea id="notes" name="notes" rows="4" placeholder="T√©rminos y condiciones, observaciones adicionales, forma de pago..."></textarea>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <span id="save-text">üíæ Guardar Factura</span>
                        <div class="loading" id="loading">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="previewInvoice()">
                        üëÅ Previsualizar
                    </button>
                    <button type="button" class="btn btn-outline" onclick="printInvoice(1)">
                        üñ® Imprimir
                    </button>
                    <button type="reset" class="btn btn-outline" onclick="resetForm()">
                        üîÑ Limpiar Formulario
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Define Records</h3>
                <p>Tu tienda especializada en vinilos con m√°s de 20 a√±os de experiencia. Encuentra desde cl√°sicos atemporales hasta las √∫ltimas novedades del mundo musical.</p>
              </div>
            
            <div class="footer-section">
                <h3>Contacto</h3>
                <p>üìç Calle de la M√∫sica 123, Centro Hist√≥rico</p>
                <p>üìû +593 98 765 4321</p>
                <p>‚úâÔ∏è info@definerecords.com</p>
                <p>üïí Lun - S√°b: 10:00 - 20:00</p>
                <p>üïí Dom: 12:00 - 18:00</p>
            </div>
            
            <div class="footer-section">
                <h3>Categor√≠as</h3>
                <a href="#">Rock & Pop</a>
                <a href="#">Jazz & Blues</a>
                <a href="#">Electr√≥nica</a>
                <a href="#">Hip Hop & R&B</a>
                <a href="#">M√∫sica Latina</a>
                <a href="#">Cl√°sica</a>
                <a href="#">Ediciones Especiales</a>
            </div>
            
            <div class="footer-section">
                <h3>Servicios</h3>
                <a href="#">Gesti√≥n de Inventario</a>
                <a href="#">Facturaci√≥n Digital</a>
                <a href="#">B√∫squeda Avanzada</a>
                <a href="#">Reservas Online</a>
                <a href="#">Intercambio de Vinilos</a>
                <a href="#">Valoraciones</a>
                <a href="#">Soporte T√©cnico</a>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 Define Records. Todos los derechos reservados. | Sistema de gesti√≥n desarrollado con ‚ù§Ô∏è para los amantes de la m√∫sica anal√≥gica.</p>
        </div>
    </footer>
	
   <!-- Account Modal -->
    <div class="modal-overlay" id="accountModal">
        <div class="account-container">
            <button class="close-btn" onclick="closeAccountModal()">&times;</button>
            
            <img src="img/fpf.png" alt="Foto de perfil" class="profile-picture">
            
            <h2 class="account-title">Mi Cuenta</h2>
            
            <div class="account-info">
                <div class="info-item">
                    <span class="info-label">Usuario:</span>
                    <span class="info-value">admin</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Nombre:</span>
                    <span class="info-value">Saray Canarte</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Rol:</span>
                    <span class="info-value">Administrador</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Email:</span>
                    <span class="info-value">saray@definerecords.com</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Estado:</span>
                    <span class="status-badge">Activo</span>
                </div>
                <div class="info-item">
                    <span class="info-label">√öltimo acceso:</span>
                    <span class="info-value">Hoy, 14:30</span>
                </div>
            </div>
			<button class="logout-btn" onclick="logoutUser()">
                Cerrar Sesi√≥n
            </button>
        </div>
    </div>

    <script>
// Constantes para localStorage
const STORAGE_KEY = 'definerecords_vinyls';
const INVOICES_KEY = 'definerecords_invoices';

// Variables globales
let vinyls = [];
let invoices = [];
let invoiceCounter = 1;

// Cargar datos desde localStorage
function loadVinyls() {
    const savedData = localStorage.getItem(STORAGE_KEY);
    if (savedData) {
        vinyls = JSON.parse(savedData);
    } else {
        // Datos iniciales si no hay nada guardado
        vinyls = [
            { id: 1, album: "Dark Side of the Moon", artist: "Pink Floyd", genre: "Rock", year: 1973, price: 45.99, stock: 2, icon: "üåô" },
            { id: 2, album: "Thriller", artist: "Michael Jackson", genre: "Pop", year: 1982, price: 38.99, stock: 0, icon: "üëª" },
            { id: 3, album: "Kind of Blue", artist: "Miles Davis", genre: "Jazz", year: 1959, price: 51.99, stock: 1, icon: "üé∫" }
        ];
        saveVinylsToStorage();
    }
}

// Cargar facturas desde localStorage
function loadInvoices() {
    const savedInvoices = localStorage.getItem(INVOICES_KEY);
    if (savedInvoices) {
        invoices = JSON.parse(savedInvoices);
    }
}

// Guardar vinilos en localStorage
function saveVinylsToStorage() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(vinyls));
}

// Guardar facturas en localStorage
function saveInvoicesToStorage() {
    localStorage.setItem(INVOICES_KEY, JSON.stringify(invoices));
}

// Poblar opciones del select con productos disponibles
function populateSelectOptions(selectElement) {
    selectElement.innerHTML = '<option value="">Seleccionar producto...</option>';
    
    vinyls.forEach(v => {
        if (v.stock > 0) {
            const option = document.createElement("option");
            option.value = v.id;
            option.textContent = `${v.icon} ${v.album} - ${v.artist} (${v.year}) - Stock: ${v.stock}`;
            option.setAttribute("data-price", v.price);
            option.setAttribute("data-stock", v.stock);
            selectElement.appendChild(option);
        }
    });
}

// Actualizar detalles del item cuando se selecciona un producto
function updateItemDetails(selectElement) {
    const selectedOption = selectElement.options[selectElement.selectedIndex];
    const price = parseFloat(selectedOption.getAttribute('data-price')) || 0;
    const maxStock = parseInt(selectedOption.getAttribute('data-stock')) || 0;

    const itemRow = selectElement.closest('.item-row');
    const priceInput = itemRow.querySelector('input[name="item-price"]');
    const quantityInput = itemRow.querySelector('input[name="item-quantity"]');
    const totalInput = itemRow.querySelector('input[name="item-total"]');

    priceInput.value = price.toFixed(2);
    
    // Establecer l√≠mite m√°ximo de cantidad seg√∫n stock disponible
    quantityInput.max = maxStock;
    quantityInput.value = Math.min(quantityInput.value, maxStock);
    
    const quantity = parseInt(quantityInput.value) || 1;
    totalInput.value = (quantity * price).toFixed(2);
    
    calculateTotal();
}

// Validar stock antes de cambiar cantidad
function validateStock(quantityInput) {
    const itemRow = quantityInput.closest('.item-row');
    const selectElement = itemRow.querySelector('select[name="item-product"]');
    const selectedOption = selectElement.options[selectElement.selectedIndex];
    const maxStock = parseInt(selectedOption.getAttribute('data-stock')) || 0;
    
    if (parseInt(quantityInput.value) > maxStock) {
        alert(`Stock insuficiente. M√°ximo disponible: ${maxStock}`);
        quantityInput.value = maxStock;
    }
    
    calculateTotal();
}

// Inicializar formulario
function initializeForm() {
    loadVinyls();
    loadInvoices();
    
    // Establecer n√∫mero de factura
    const nextNumber = String(invoices.length + 1).padStart(5, '0');
    document.getElementById('invoice-number').value = 'FAC-' + nextNumber;
    
    // Establecer fecha actual
    document.getElementById('invoice-date').value = new Date().toISOString().split('T')[0];
    
    // Establecer fecha de vencimiento (30 d√≠as desde ahora)
    const dueDate = new Date();
    dueDate.setDate(dueDate.getDate() + 30);
    document.getElementById('due-date').value = dueDate.toISOString().split('T')[0];
    
    // Poblar el primer select
    const firstSelect = document.querySelector('select[name="item-product"]');
    populateSelectOptions(firstSelect);
    
    calculateTotal();
}

// Agregar nuevo item
function addItem() {
    const container = document.getElementById('items-container');
    const newItem = document.createElement('div');
    newItem.className = 'item-row';
    newItem.innerHTML = `
        <div class="form-group">
            <label>Producto/Servicio *</label>
            <select name="item-product" onchange="updateItemDetails(this)" required>
                <option value="">Seleccionar producto...</option>
            </select>
        </div>
        <div class="form-group">
            <label>Cantidad *</label>
            <input type="number" name="item-quantity" min="1" value="1" onchange="validateStock(this)" required>
        </div>
        <div class="form-group">
            <label>Precio Unitario *</label>
            <input type="number" name="item-price" step="0.01" min="0" onchange="calculateTotal()" placeholder="0.00" readonly>
        </div>
        <div class="form-group">
            <label>Total</label>
            <input type="number" name="item-total" step="0.01" readonly>
        </div>
        <div class="form-group">
            <button type="button" class="remove-item-btn" onclick="removeItem(this)" title="Eliminar item">
                <span>üóë</span>
            </button>
        </div>
    `;

    container.appendChild(newItem);

    // Poblar el select del nuevo item
    const select = newItem.querySelector('select[name="item-product"]');
    populateSelectOptions(select);
}

// Remover item
function removeItem(button) {
    const itemRow = button.closest('.item-row');
    const container = document.getElementById('items-container');
    
    // No permitir eliminar si solo hay un item
    if (container.children.length > 1) {
        itemRow.remove();
        calculateTotal();
    } else {
        alert('Debe mantener al menos un item en la factura');
    }
}

// Calcular totales
function calculateTotal() {
    const items = document.querySelectorAll('.item-row');
    let subtotal = 0;

    items.forEach(item => {
        const quantity = parseFloat(item.querySelector('[name="item-quantity"]').value) || 0;
        const price = parseFloat(item.querySelector('[name="item-price"]').value) || 0;
        const total = quantity * price;
        
        item.querySelector('[name="item-total"]').value = total.toFixed(2);
        subtotal += total;
    });

    const discount = parseFloat(document.getElementById('discount').value) || 0;
    const subtotalWithDiscount = subtotal - discount;
    const tax = subtotalWithDiscount * 0.12; // 12% IVA
    const finalTotal = subtotalWithDiscount + tax;

    document.getElementById('subtotal').textContent = '$' + subtotal.toFixed(2);
    document.getElementById('tax').textContent = '$' + tax.toFixed(2);
    document.getElementById('final-total').textContent = '$' + Math.max(0, finalTotal).toFixed(2);
}

// Actualizar stock despu√©s de crear factura
function updateStock(items) {
    items.forEach(item => {
        const vinylId = parseInt(item.productId);
        const quantity = parseInt(item.quantity);
        
        const vinylIndex = vinyls.findIndex(v => v.id === vinylId);
        if (vinylIndex !== -1) {
            vinyls[vinylIndex].stock -= quantity;
        }
    });
    
    saveVinylsToStorage();
}

// Manejar env√≠o del formulario
document.getElementById('invoiceForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Mostrar loading
    document.getElementById('loading').style.display = 'flex';
    document.getElementById('save-text').style.display = 'none';
    
    // Validar que hay items seleccionados
    const items = document.querySelectorAll('.item-row');
    let hasValidItems = false;
    let invoiceItems = [];
    
    items.forEach(item => {
        const select = item.querySelector('select[name="item-product"]');
        const quantity = parseInt(item.querySelector('input[name="item-quantity"]').value);
        const price = parseFloat(item.querySelector('input[name="item-price"]').value);
        
        if (select.value && quantity > 0 && price > 0) {
            hasValidItems = true;
            
            // Obtener datos del vinilo
            const vinyl = vinyls.find(v => v.id == select.value);
            
            invoiceItems.push({
                productId: select.value,
                productName: vinyl.album,
                artist: vinyl.artist,
                quantity: quantity,
                price: price,
                total: quantity * price
            });
        }
    });
    
    if (!hasValidItems) {
        alert('Debe agregar al menos un item v√°lido a la factura');
        document.getElementById('loading').style.display = 'none';
        document.getElementById('save-text').style.display = 'inline';
        return;
    }
    
    // Crear objeto de factura
    const formData = new FormData(this);
    const invoice = {
        id: invoices.length + 1,
        number: formData.get('invoice-number'),
        date: formData.get('invoice-date'),
        dueDate: formData.get('due-date'),
        paymentMethod: formData.get('payment-method'),
        client: {
            name: formData.get('client-name'),
            document: formData.get('client-document'),
            email: formData.get('client-email'),
            phone: formData.get('client-phone'),
            address: formData.get('client-address')
        },
        items: invoiceItems,
        subtotal: parseFloat(document.getElementById('subtotal').textContent.replace('$', '')),
        tax: parseFloat(document.getElementById('tax').textContent.replace('$', '')),
        discount: parseFloat(document.getElementById('discount').value) || 0,
        total: parseFloat(document.getElementById('final-total').textContent.replace('$', '')),
        notes: formData.get('notes'),
        createdAt: new Date().toISOString()
    };
    
    // Simular guardado
    setTimeout(() => {
        // Actualizar stock
        updateStock(invoiceItems);
        
        // Guardar factura
        invoices.push(invoice);
        saveInvoicesToStorage();
        
        // Mostrar mensaje de √©xito
        document.getElementById('loading').style.display = 'none';
        document.getElementById('save-text').style.display = 'inline';
        document.getElementById('successMessage').style.display = 'flex';
        
        // Limpiar formulario despu√©s de 2 segundos
        setTimeout(() => {
            document.getElementById('successMessage').style.display = 'none';
            resetForm();
        }, 2000);
        
    }, 1500);
});

// Previsualizar factura
function previewInvoice() {
    const formData = new FormData(document.getElementById('invoiceForm'));
    const invoiceData = {
        number: formData.get('invoice-number'),
        date: formData.get('invoice-date'),
        client: formData.get('client-name'),
        total: document.getElementById('final-total').textContent
    };

    alert(`Vista Previa de Factura:
    
N√∫mero: ${invoiceData.number}
Fecha: ${invoiceData.date}
Cliente: ${invoiceData.client}
Total: ${invoiceData.total}`);
}

// Imprimir factura
function printInvoice() {
    alert('Funci√≥n de impresi√≥n - En desarrollo. Aqu√≠ se generar√≠a un PDF de la factura.');
}

// Resetear formulario
function resetForm() {
    if (confirm('¬øEst√° seguro de que desea limpiar todo el formulario? Se perder√°n todos los datos ingresados.')) {
        document.getElementById('invoiceForm').reset();
        
        // Remover items extra, mantener solo uno
        const container = document.getElementById('items-container');
        while (container.children.length > 1) {
            container.removeChild(container.lastChild);
        }
        
        // Reinicializar
        initializeForm();
        calculateTotal();
    }
}

// Funciones del modal de cuenta
function openAccountModal() {
    document.getElementById('accountModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeAccountModal() {
    document.getElementById('accountModal').classList.remove('active');
    document.body.style.overflow = 'auto';
}

function logoutUser() {
    if (confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?')) {
        alert('Sesi√≥n cerrada exitosamente. ¬°Hasta pronto!');
        closeAccountModal();
        window.location.href = 'index.html';
    }
}

// Event listeners
document.getElementById('accountModal').addEventListener('click', function(event) {
    if (event.target === this) {
        closeAccountModal();
    }
});

document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape' && document.getElementById('accountModal').classList.contains('active')) {
        closeAccountModal();
    }
});

// Inicializar cuando se carga la p√°gina
window.addEventListener('load', function() {
    initializeForm();
});

// Actualizar el input de cantidad en el HTML existente
document.addEventListener('DOMContentLoaded', function() {
    const quantityInput = document.querySelector('input[name="item-quantity"]');
    if (quantityInput) {
        quantityInput.setAttribute('onchange', 'validateStock(this)');
    }
});
		
// Funci√≥n para imprimir la factura actual (genera PDF)
function printInvoice() {
    // Obtener datos del formulario actual
    const formData = getFormData();
    
    if (!formData) {
        alert('Por favor, complete la informaci√≥n de la factura antes de imprimir');
        return;
    }

    // Crear ventana de impresi√≥n
    const printWindow = window.open('', '_blank', 'width=800,height=600');
    
    // Formatear fechas
    const invoiceDate = new Date(formData.date || new Date()).toLocaleDateString('es-ES');
    const dueDate = new Date(formData.dueDate || new Date()).toLocaleDateString('es-ES');
    
    // Generar HTML para los items
    const itemsHTML = formData.items.map(item => `
        <tr>
            <td>${item.productName}</td>
            <td>${item.artist || 'N/A'}</td>
            <td style="text-align: center;">${item.quantity}</td>
            <td style="text-align: right;">$${item.price.toFixed(2)}</td>
            <td style="text-align: right;">$${item.total.toFixed(2)}</td>
        </tr>
    `).join('');

    // Contenido HTML para impresi√≥n (PDF)
    const printContent = `
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Factura ${formData.number || 'NUEVA'}</title>
            <style>
                /* Estilos solo para impresi√≥n/PDF */
                @media print {
                    body { 
                        margin: 0; 
                        padding: 15px;
                        font-family: Arial, sans-serif;
                        font-size: 12px;
                        line-height: 1.4;
                        color: #000;
                    }
                    
                    .invoice-container {
                        max-width: 800px;
                        margin: 0 auto;
                        background: white;
                    }
                    
                    .invoice-header {
                        text-align: center;
                        margin-bottom: 25px;
                        border-bottom: 2px solid #000;
                        padding-bottom: 15px;
                    }
                    
                    .company-name {
                        font-size: 22px;
                        font-weight: bold;
                        color: #000;
                        margin: 0 0 5px 0;
                    }
                    
                    .invoice-title {
                        font-size: 18px;
                        font-weight: bold;
                        margin: 10px 0 0 0;
                        color: #000;
                    }
                    
                    .invoice-details {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 25px;
                        gap: 20px;
                    }
                    
                    .invoice-info, .client-info {
                        width: 48%;
                    }
                    
                    .section-title {
                        font-size: 14px;
                        font-weight: bold;
                        margin-bottom: 8px;
                        color: #000;
                        border-bottom: 1px solid #ccc;
                        padding-bottom: 3px;
                    }
                    
                    .info-line {
                        margin-bottom: 4px;
                        font-size: 11px;
                    }
                    
                    .items-table {
                        width: 100%;
                        border-collapse: collapse;
                        margin-bottom: 20px;
                        font-size: 11px;
                    }
                    
                    .items-table th,
                    .items-table td {
                        border: 1px solid #000;
                        padding: 6px;
                        text-align: left;
                    }
                    
                    .items-table th {
                        background-color: #f0f0f0;
                        font-weight: bold;
                        font-size: 12px;
                    }
                    
                    .totals-section {
                        margin-top: 20px;
                        text-align: right;
                    }
                    
                    .totals-table {
                        margin-left: auto;
                        border-collapse: collapse;
                        width: 250px;
                        font-size: 11px;
                    }
                    
                    .totals-table td {
                        padding: 4px 8px;
                        border-bottom: 1px solid #ccc;
                    }
                    
                    .total-final {
                        font-weight: bold;
                        font-size: 14px;
                        border-top: 2px solid #000;
                        background-color: #f0f0f0;
                    }
                    
                    .notes-section {
                        margin-top: 25px;
                        padding-top: 15px;
                        border-top: 1px solid #ccc;
                        font-size: 11px;
                    }
                    
                    .footer {
                        margin-top: 30px;
                        text-align: center;
                        font-size: 10px;
                        color: #666;
                        border-top: 1px solid #ccc;
                        padding-top: 10px;
                    }
                }
                
                /* Estilos para pantalla (vista previa) */
                @media screen {
                    body { 
                        margin: 20px;
                        font-family: Arial, sans-serif;
                        background-color: #f5f5f5;
                    }
                    
                    .invoice-container {
                        max-width: 800px;
                        margin: 0 auto;
                        background: white;
                        padding: 30px;
                        box-shadow: 0 0 10px rgba(0,0,0,0.1);
                    }
                    
                    .invoice-header {
                        text-align: center;
                        margin-bottom: 30px;
                        border-bottom: 2px solid #333;
                        padding-bottom: 20px;
                    }
                    
                    .company-name {
                        font-size: 24px;
                        font-weight: bold;
                        color: #2c3e50;
                        margin: 0 0 10px 0;
                    }
                    
                    .invoice-title {
                        font-size: 20px;
                        font-weight: bold;
                        margin: 15px 0 0 0;
                        color: #2c3e50;
                    }
                    
                    .invoice-details {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 30px;
                        gap: 30px;
                    }
                    
                    .invoice-info, .client-info {
                        width: 48%;
                    }
                    
                    .section-title {
                        font-size: 16px;
                        font-weight: bold;
                        margin-bottom: 10px;
                        color: #2c3e50;
                        border-bottom: 1px solid #ddd;
                        padding-bottom: 5px;
                    }
                    
                    .info-line {
                        margin-bottom: 5px;
                        font-size: 14px;
                    }
                    
                    .items-table {
                        width: 100%;
                        border-collapse: collapse;
                        margin-bottom: 20px;
                        font-size: 14px;
                    }
                    
                    .items-table th,
                    .items-table td {
                        border: 1px solid #ddd;
                        padding: 10px;
                        text-align: left;
                    }
                    
                    .items-table th {
                        background-color: #f8f9fa;
                        font-weight: bold;
                    }
                    
                    .totals-section {
                        margin-top: 20px;
                        text-align: right;
                    }
                    
                    .totals-table {
                        margin-left: auto;
                        border-collapse: collapse;
                        width: 300px;
                        font-size: 14px;
                    }
                    
                    .totals-table td {
                        padding: 8px 12px;
                        border-bottom: 1px solid #ddd;
                    }
                    
                    .total-final {
                        font-weight: bold;
                        font-size: 16px;
                        border-top: 2px solid #333;
                        background-color: #f8f9fa;
                    }
                    
                    .notes-section {
                        margin-top: 30px;
                        padding-top: 20px;
                        border-top: 1px solid #ddd;
                    }
                    
                    .footer {
                        margin-top: 40px;
                        text-align: center;
                        font-size: 12px;
                        color: #666;
                        border-top: 1px solid #ddd;
                        padding-top: 15px;
                    }
                    
                    .print-button {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #007bff;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 14px;
                        z-index: 1000;
                    }
                    
                    .print-button:hover {
                        background: #0056b3;
                    }
                }
            </style>
        </head>
        <body>
            <div class="invoice-container">
                <button class="print-button" onclick="window.print()">üñ®Ô∏è Imprimir PDF</button>
                
                <div class="invoice-header">
                    <div class="company-name">DEFINE RECORDS</div>
                    <p>Sistema de Facturaci√≥n</p>
                    <h1 class="invoice-title">FACTURA</h1>
                </div>

                <div class="invoice-details">
                    <div class="invoice-info">
                        <div class="section-title">Informaci√≥n de la Factura</div>
                        <div class="info-line"><strong>N√∫mero:</strong> ${formData.number || 'NUEVA'}</div>
                        <div class="info-line"><strong>Fecha de Emisi√≥n:</strong> ${invoiceDate}</div>
                        <div class="info-line"><strong>Fecha de Vencimiento:</strong> ${dueDate}</div>
                        <div class="info-line"><strong>M√©todo de Pago:</strong> ${(formData.paymentMethod || 'efectivo').toUpperCase()}</div>
                    </div>

                    <div class="client-info">
                        <div class="section-title">Informaci√≥n del Cliente</div>
                        <div class="info-line"><strong>Cliente:</strong> ${formData.client.name || 'N/A'}</div>
                        ${formData.client.document ? `<div class="info-line"><strong>Documento:</strong> ${formData.client.document}</div>` : ''}
                        ${formData.client.email ? `<div class="info-line"><strong>Email:</strong> ${formData.client.email}</div>` : ''}
                        ${formData.client.phone ? `<div class="info-line"><strong>Tel√©fono:</strong> ${formData.client.phone}</div>` : ''}
                        ${formData.client.address ? `<div class="info-line"><strong>Direcci√≥n:</strong> ${formData.client.address}</div>` : ''}
                    </div>
                </div>

                <div class="section-title">Detalle de Productos/Servicios</div>
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Artista</th>
                            <th>Cantidad</th>
                            <th>Precio Unitario</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${itemsHTML}
                    </tbody>
                </table>

                <div class="totals-section">
                    <table class="totals-table">
                        <tr>
                            <td><strong>Subtotal:</strong></td>
                            <td>$${formData.subtotal.toFixed(2)}</td>
                        </tr>
                        ${formData.discount > 0 ? `
                        <tr>
                            <td><strong>Descuento:</strong></td>
                            <td>-$${formData.discount.toFixed(2)}</td>
                        </tr>
                        ` : ''}
                        <tr>
                            <td><strong>IVA (12%):</strong></td>
                            <td>$${formData.tax.toFixed(2)}</td>
                        </tr>
                        <tr class="total-final">
                            <td><strong>TOTAL:</strong></td>
                            <td><strong>$${formData.total.toFixed(2)}</strong></td>
                        </tr>
                    </table>
                </div>

                ${formData.notes ? `
                <div class="notes-section">
                    <div class="section-title">Observaciones</div>
                    <p>${formData.notes}</p>
                </div>
                ` : ''}

                <div class="footer">
                    <p>Gracias por su compra | Define Records</p>
                    <p>Factura generada el ${new Date().toLocaleDateString('es-ES')} a las ${new Date().toLocaleTimeString('es-ES')}</p>
                </div>
            </div>
        </body>
        </html>
    `;

    // Escribir contenido en la ventana de impresi√≥n
    printWindow.document.write(printContent);
    printWindow.document.close();

    // Esperar a que se cargue completamente
    printWindow.onload = function() {
        // Enfocar la ventana para que aparezca autom√°ticamente el di√°logo de impresi√≥n
        printWindow.focus();
        // Mostrar di√°logo de impresi√≥n (que permite guardar como PDF)
        setTimeout(() => {
            printWindow.print();
        }, 250);
    };
}

// Funci√≥n auxiliar para obtener datos del formulario actual
function getFormData() {
    try {
        // Obtener informaci√≥n del cliente (probando m√∫ltiples IDs posibles)
        const clientName = document.getElementById('clientName')?.value || 
                          document.getElementById('cliente')?.value || 
                          document.querySelector('input[name="clientName"]')?.value || '';
        
        const clientDocument = document.getElementById('clientDocument')?.value || 
                              document.getElementById('documento')?.value || 
                              document.querySelector('input[name="clientDocument"]')?.value || '';
        
        const clientEmail = document.getElementById('clientEmail')?.value || 
                           document.getElementById('email')?.value || 
                           document.querySelector('input[name="clientEmail"]')?.value || '';
        
        const clientPhone = document.getElementById('clientPhone')?.value || 
                           document.getElementById('telefono')?.value || 
                           document.querySelector('input[name="clientPhone"]')?.value || '';
        
        const clientAddress = document.getElementById('clientAddress')?.value || 
                             document.getElementById('direccion')?.value || 
                             document.querySelector('input[name="clientAddress"]')?.value || '';

        // Obtener informaci√≥n de la factura
        const invoiceNumber = document.getElementById('invoiceNumber')?.value || 
                             document.getElementById('numeroFactura')?.value || 
                             document.querySelector('input[name="invoiceNumber"]')?.value || 
                             `FAC-${Date.now()}`;
        
        const invoiceDate = document.getElementById('invoiceDate')?.value || 
                           document.getElementById('fecha')?.value || 
                           document.querySelector('input[name="invoiceDate"]')?.value || 
                           new Date().toISOString().split('T')[0];
        
        const dueDate = document.getElementById('dueDate')?.value || 
                       document.getElementById('fechaVencimiento')?.value || 
                       document.querySelector('input[name="dueDate"]')?.value || '';
        
        const paymentMethod = document.getElementById('paymentMethod')?.value || 
                             document.getElementById('metodoPago')?.value || 
                             document.querySelector('select[name="paymentMethod"]')?.value || 'efectivo';
        
        const notes = document.getElementById('notes')?.value || 
                     document.getElementById('observaciones')?.value || 
                     document.querySelector('textarea[name="notes"]')?.value || '';

        // Obtener items - probando m√∫ltiples formas de encontrar la tabla
        let items = [];
        
        // M√©todo 1: Buscar en tabla con ID espec√≠fico
        const itemsTable = document.getElementById('itemsTable') || 
                          document.getElementById('productosTable') || 
                          document.querySelector('.items-table') ||
                          document.querySelector('table');
        
        if (itemsTable) {
            const rows = itemsTable.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 4) { // Al menos 4 columnas
                    const productName = cells[0]?.textContent?.trim() || '';
                    const artist = cells[1]?.textContent?.trim() || '';
                    const quantity = parseInt(cells[2]?.textContent?.trim()) || 1;
                    const price = parseFloat(cells[3]?.textContent?.replace(', '').trim()) || 0;
                    const total = cells[4] ? parseFloat(cells[4]?.textContent?.replace(', '').trim()) : (quantity * price);
                    
                    if (productName && price > 0) {
                        items.push({
                            productName: productName,
                            artist: artist,
                            quantity: quantity,
                            price: price,
                            total: total
                        });
                    }
                }
            });
        }
        
        // M√©todo 2: Buscar en variables globales (si existen)
        if (items.length === 0 && typeof selectedProducts !== 'undefined') {

            items = selectedProducts.map(product => ({
                productName: product.name || product.productName || '',
                artist: product.artist || '',
                quantity: product.quantity || 1,
                price: product.price || 0,
                total: product.total || (product.quantity * product.price)
            }));
        }
        
        // M√©todo 3: Buscar en inputs del formulario
        if (items.length === 0) {
            const productInputs = document.querySelectorAll('input[name*="product"], select[name*="product"]');
            const quantityInputs = document.querySelectorAll('input[name*="quantity"], input[name*="cantidad"]');
            const priceInputs = document.querySelectorAll('input[name*="price"], input[name*="precio"]');
            
            for (let i = 0; i < productInputs.length; i++) {
                const productName = productInputs[i]?.value || '';
                const quantity = parseInt(quantityInputs[i]?.value) || 1;
                const price = parseFloat(priceInputs[i]?.value) || 0;
                
                if (productName && price > 0) {
                    items.push({
                        productName: productName,
                        artist: '',
                        quantity: quantity,
                        price: price,
                        total: quantity * price
                    });
                }
            }
        }

        // Debug: Mostrar informaci√≥n encontrada
        console.log('Datos capturados:', {
            clientName,
            items: items.length,
            itemsTable: !!itemsTable,
            selectedProducts: typeof selectedProducts !== 'undefined' ? selectedProducts : 'no definido'
        });

        // Validar que hay items
        if (items.length === 0) {
            alert('No se pudieron encontrar productos en la factura. Aseg√∫rese de haber agregado productos antes de imprimir.');
            
            // Mostrar informaci√≥n de debug
            console.log('Elementos encontrados en la p√°gina:');
            console.log('- Tablas:', document.querySelectorAll('table').length);
            console.log('- Inputs de producto:', document.querySelectorAll('input[name*="product"], select[name*="product"]').length);
            console.log('- Variable selectedProducts:', typeof selectedProducts);
            
            return null;
        }

        // Calcular totales desde los inputs o desde los items
        let subtotal = 0;
        let discount = 0;
        let tax = 0;
        let total = 0;
        
        // Intentar obtener totales de los elementos del DOM
        const subtotalElement = document.getElementById('subtotal') || 
                               document.getElementById('subtotalAmount') || 
                               document.querySelector('.subtotal');
        
        const discountElement = document.getElementById('discount') || 
                               document.getElementById('descuento') || 
                               document.querySelector('.discount');
        
        const taxElement = document.getElementById('tax') || 
                          document.getElementById('iva') || 
                          document.querySelector('.tax');
        
        const totalElement = document.getElementById('total') || 
                            document.getElementById('totalAmount') || 
                            document.querySelector('.total');
        
        if (subtotalElement) {
            subtotal = parseFloat(subtotalElement.textContent?.replace(', '').trim() || subtotalElement.value || 0);
        } else {
            subtotal = items.reduce((sum, item) => sum + item.total, 0);
        }
        
        if (discountElement) {
            discount = parseFloat(discountElement.textContent?.replace(', '').trim() || discountElement.value || 0);
        }
        
        if (taxElement) {
            tax = parseFloat(taxElement.textContent?.replace(', '').trim() || taxElement.value || 0);
        } else {
            tax = (subtotal - discount) * 0.12;
        }
        
        if (totalElement) {
            total = parseFloat(totalElement.textContent?.replace(', '').trim() || totalElement.value || 0);
        } else {
            total = subtotal - discount + tax;
        }

        return {
            number: invoiceNumber,
            date: invoiceDate,
            dueDate: dueDate,
            paymentMethod: paymentMethod,
            client: {
                name: clientName,
                document: clientDocument,
                email: clientEmail,
                phone: clientPhone,
                address: clientAddress
            },
            items: items,
            subtotal: subtotal,
            discount: discount,
            tax: tax,
            total: total,
            notes: notes
        };
    } catch (error) {
        console.error('Error obteniendo datos del formulario:', error);
        alert('Error al obtener los datos del formulario. Revise la consola para m√°s detalles.');
        return null;
    }
}
	</script>
	</body>
</html>