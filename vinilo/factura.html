<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Facturaci√≥n</title>
<link rel="stylesheet" href="styleBill/estilo1.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <img src="img/logo.png" alt="Logo" id="logo-img">
            <span style="font-weight: bold; color: #F87154;">Define Records</span>
        </div>
        <nav class="nav">
            <a href="sesion.html" class="nav-link">Inicio</a>
            <a href="inventario.html" class="nav-link">Inventario</a>
            <a href="factura.html" class="nav-link">Facturas</a>
            <a href="#" class="nav-link">Ayuda</a>
            <button class="account-btn" onclick="openAccountModal()">Mi Cuenta</button>
        </nav>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Title Section -->
        <div class="title-section">
            <h1>Sistema de Facturaci√≥n</h1>
        </div>

        <!-- Control Bar -->
		<div class="control-bar">
			<button class="filter-btn" onclick="toggleFilter()">
				<span>üîΩ</span>
				Filtrar
			</button>
			<button class="add-btn" onclick="window.location.href='a√±adirFactura.html'">
				<span>+</span>
				Agregar Factura
			</button>
			<button class="add-btn" onclick="window.location.href='reporteVentas.html'">
				<span>üìä</span>
				Reporte
			</button>
			<button class="search-icon">üîç</button>
		</div>
		
		<div class="filter-section" id="filterSection" style="display: none; margin-bottom: 20px;">
			<div class="form-grid">
				<div class="form-group">
					<label for="clienteFilter">Cliente</label>
					<input type="text" id="clienteFilter" placeholder="Nombre del cliente">
				</div>
				<div class="form-group">
					<label for="fechaInicio">Fecha desde</label>
					<input type="date" id="fechaInicio">
				</div>
				<div class="form-group">
					<label for="fechaFin">Fecha hasta</label>
					<input type="date" id="fechaFin">
				</div>
				<div class="form-group" style="align-self: end;">
					<button class="btn-secondary" onclick="aplicarFiltros()">Aplicar Filtros</button>
				</div>
			</div>
		</div>

		<!-- Invoice List -->
		<div class="invoice-list" id="invoiceList">
			<!-- Las facturas se cargar√°n din√°micamente aqu√≠ -->
		</div>

        <!-- Load More Section -->
        <div class="load-more">
            <button class="load-more-btn" onclick="loadMoreInvoices()">
                <span>‚ñº</span>
                Mostrar M√°s
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Define Records</h3>
                <p>Tu tienda especializada en vinilos con m√°s de 20 a√±os de experiencia. Encuentra desde cl√°sicos atemporales hasta las √∫ltimas novedades del mundo musical.</p>
              </div>
            
            <div class="footer-section">
                <h3>Contacto</h3>
                <p>üìç Calle de la M√∫sica 123, Centro Hist√≥rico</p>
                <p>üìû +593 98 765 4321</p>
                <p>‚úâÔ∏è info@definerecords.com</p>
                <p>üïí Lun - S√°b: 10:00 - 20:00</p>
                <p>üïí Dom: 12:00 - 18:00</p>
            </div>
            
            <div class="footer-section">
                <h3>Categor√≠as</h3>
                <a href="#">Rock & Pop</a>
                <a href="#">Jazz & Blues</a>
                <a href="#">Electr√≥nica</a>
                <a href="#">Hip Hop & R&B</a>
                <a href="#">M√∫sica Latina</a>
                <a href="#">Cl√°sica</a>
                <a href="#">Ediciones Especiales</a>
            </div>
            
            <div class="footer-section">
                <h3>Servicios</h3>
                <a href="#">Gesti√≥n de Inventario</a>
                <a href="#">Facturaci√≥n Digital</a>
                <a href="#">B√∫squeda Avanzada</a>
                <a href="#">Reservas Online</a>
                <a href="#">Intercambio de Vinilos</a>
                <a href="#">Valoraciones</a>
                <a href="#">Soporte T√©cnico</a>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 Define Records. Todos los derechos reservados. | Sistema de gesti√≥n desarrollado con ‚ù§Ô∏è para los amantes de la m√∫sica anal√≥gica.</p>
        </div>
    </footer>

   <!-- Account Modal -->
    <div class="modal-overlay" id="accountModal">
        <div class="account-container">
            <button class="close-btn" onclick="closeAccountModal()">&times;</button>
            
            <img src="img/fpf.png" alt="Foto de perfil" class="profile-picture">
            
            <h2 class="account-title">Mi Cuenta</h2>
            
            <div class="account-info">
                <div class="info-item">
                    <span class="info-label">Usuario:</span>
                    <span class="info-value">admin</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Nombre:</span>
                    <span class="info-value">Saray Canarte</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Rol:</span>
                    <span class="info-value">Administrador</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Email:</span>
                    <span class="info-value">saray@definerecords.com</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Estado:</span>
                    <span class="status-badge">Activo</span>
                </div>
                <div class="info-item">
                    <span class="info-label">√öltimo acceso:</span>
                    <span class="info-value">Hoy, 14:30</span>
                </div>
            </div>
			<button class="logout-btn" onclick="logoutUser()">
                Cerrar Sesi√≥n
            </button>
        </div>
    </div>
		<div class="modal-overlay" id="invoiceDetailModal">
		  <div class="modal-content">
			<button class="close-btn" onclick="closeInvoiceDetailModal()">√ó</button>
			<h2>Detalle de Factura</h2>
			<div id="invoiceDetailContent">
			</div>
		  </div>
	</div>


    <script>
		
		// Funciones para el modal de cuenta
        function openAccountModal() {
            document.getElementById('accountModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeAccountModal() {
            document.getElementById('accountModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Cerrar modal al hacer click fuera de √©l
        document.getElementById('accountModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAccountModal();
            }
        });

        // Cerrar modal con tecla Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && document.getElementById('accountModal').classList.contains('active')) {
                closeAccountModal();
            }
        });
		
		function logoutUser() {
            // Confirmar cierre de sesi√≥n
            if (confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?')) {
                // Mostrar mensaje de confirmaci√≥n
                alert('Sesi√≥n cerrada exitosamente. ¬°Hasta pronto!');
                
                // Cerrar el modal
                closeAccountModal();
                
                // Opcional: Redirigir a p√°gina de login o recargar
                window.location.href = 'index.html';
                // O simplemente recargar la p√°gina actual
                
            }
        }

        // Cerrar modal al hacer click fuera de √©l
        document.getElementById('accountModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAccountModal();
            }
        });

        // Cerrar modal con tecla Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && document.getElementById('accountModal').classList.contains('active')) {
                closeAccountModal();
            }
        });

// Constantes para localStorage
const INVOICES_KEY = 'definerecords_invoices';

// Variables globales
let invoices = [];
let currentIndex = 0;
const ITEMS_PER_PAGE = 5;

// Cargar facturas desde localStorage
function loadInvoices() {
    const savedInvoices = localStorage.getItem(INVOICES_KEY);
    if (savedInvoices) {
        invoices = JSON.parse(savedInvoices);
    } else {
        // Facturas base por defecto
        invoices = [
            {
                id: 1,
                number: 'FAC-00001',
                date: '2025-01-15',
                dueDate: '2025-02-14',
                paymentMethod: 'efectivo',
                client: {
                    name: 'Saray Ca√±arte',
                    document: '1234567890',
                    email: 'saray@email.com',
                    phone: '0987654321',
                    address: 'Av. Principal 123'
                },
                items: [
                    {
                        productId: '1',
                        productName: 'Stray Kids - CIRCUS',
                        artist: 'Stray Kids',
                        quantity: 1,
                        price: 75.00,
                        total: 75.00
                    }
                ],
                subtotal: 75.00,
                tax: 9.00,
                discount: 0,
                total: 84.00,
                notes: 'Factura de ejemplo',
                createdAt: '2025-01-15T10:30:00.000Z'
            },
            {
                id: 2,
                number: 'FAC-00002',
                date: '2025-01-16',
                dueDate: '2025-02-15',
                paymentMethod: 'tarjeta',
                client: {
                    name: 'Dom√©nica Villag√≥mez',
                    document: '0987654321',
                    email: 'domenica@email.com',
                    phone: '0912345678',
                    address: 'Calle Secundaria 456'
                },
                items: [
                    {
                        productId: '2',
                        productName: 'Thriller',
                        artist: 'Michael Jackson',
                        quantity: 1,
                        price: 38.99,
                        total: 38.99
                    }
                ],
                subtotal: 38.99,
                tax: 4.68,
                discount: 0,
                total: 43.67,
                notes: 'Pago con tarjeta',
                createdAt: '2025-01-16T14:15:00.000Z'
            }
        ];
        saveInvoicesToStorage();
    }
}

// Guardar facturas en localStorage
function saveInvoicesToStorage() {
    localStorage.setItem(INVOICES_KEY, JSON.stringify(invoices));
}

// Renderizar facturas en la lista
function renderInvoices(invoicesToRender = null) {
    const invoiceList = document.getElementById("invoiceList");
    const invoicesToShow = invoicesToRender || invoices.slice(0, currentIndex + ITEMS_PER_PAGE);
    
    if (!invoicesToRender) {
        currentIndex = Math.min(currentIndex + ITEMS_PER_PAGE, invoices.length);
    }

    invoicesToShow.forEach(invoice => {
        // Verificar si la factura ya est√° renderizada
        if (document.querySelector(`[data-invoice-id="${invoice.id}"]`)) {
            return;
        }

        const invoiceDate = new Date(invoice.date).toLocaleDateString('es-ES');
        const itemsPreview = invoice.items.map(item => `${item.productName} - ${item.artist}`).join(', ');

        const invoiceElement = document.createElement("div");
        invoiceElement.classList.add("invoice-item");
        invoiceElement.setAttribute("data-invoice-id", invoice.id);
        invoiceElement.setAttribute("data-fecha", invoice.date);
        invoiceElement.innerHTML = `
            <div class="invoice-header">
                <div class="invoice-number">${invoice.number}</div>
                <div class="invoice-total">Total: $${invoice.total.toFixed(2)}</div>
            </div>
            <div class="invoice-details">
                <div class="invoice-detail">${invoice.client.name}</div>
                <div class="invoice-detail">Detalle: ${itemsPreview}</div>
                <div class="invoice-detail">Fecha: ${invoiceDate}</div>
            </div>
            <div class="invoice-actions">
                <button class="view-complete-btn" onclick="openInvoiceDetailModal(${invoice.id})">Ver Completo</button>
            </div>
        `;

        invoiceList.appendChild(invoiceElement);
    });

    // Controlar visibilidad del bot√≥n "Mostrar M√°s"
    const loadMoreBtn = document.querySelector('.load-more-btn');
    if (loadMoreBtn) {
        loadMoreBtn.style.display = currentIndex >= invoices.length ? 'none' : 'block';
    }
}

// Abrir modal de detalle de factura
function openInvoiceDetailModal(invoiceId) {
    const modal = document.getElementById("invoiceDetailModal");
    const content = document.getElementById("invoiceDetailContent");

    // Buscar la factura por ID
    const factura = invoices.find(inv => inv.id === invoiceId);

    if (!factura) {
        alert('Factura no encontrada');
        return;
    }

    // Generar HTML para los items
    const itemsHTML = factura.items.map(item => `
        <div class="item" style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            <strong>${item.productName}</strong> - ${item.artist}<br>
            Cantidad: ${item.quantity}<br>
            Precio Unitario: $${item.price.toFixed(2)}<br>
            Subtotal: $${item.total.toFixed(2)}
        </div>
    `).join("");

    // Formatear fechas
    const invoiceDate = new Date(factura.date).toLocaleDateString('es-ES');
    const dueDate = new Date(factura.dueDate).toLocaleDateString('es-ES');

    // Generar contenido del modal
    content.innerHTML = `
        <div class="invoice-detail-header" style="margin-bottom: 20px;">
            <h3>${factura.number}</h3>
            <p><strong>Fecha de Emisi√≥n:</strong> ${invoiceDate}</p>
            <p><strong>Fecha de Vencimiento:</strong> ${dueDate}</p>
            <p><strong>M√©todo de Pago:</strong> ${factura.paymentMethod}</p>
        </div>

        <div class="client-info" style="margin-bottom: 20px;">
            <h4>Informaci√≥n del Cliente</h4>
            <p><strong>Cliente:</strong> ${factura.client.name}</p>
            ${factura.client.document ? `<p><strong>Documento:</strong> ${factura.client.document}</p>` : ''}
            ${factura.client.email ? `<p><strong>Email:</strong> ${factura.client.email}</p>` : ''}
            ${factura.client.phone ? `<p><strong>Tel√©fono:</strong> ${factura.client.phone}</p>` : ''}
            ${factura.client.address ? `<p><strong>Direcci√≥n:</strong> ${factura.client.address}</p>` : ''}
        </div>

        <div class="items-info" style="margin-bottom: 20px;">
            <h4>Productos/Servicios</h4>
            ${itemsHTML}
        </div>

        <div class="totals-info" style="margin-bottom: 20px;">
            <h4>Totales</h4>
            <p><strong>Subtotal:</strong> $${factura.subtotal.toFixed(2)}</p>
            ${factura.discount > 0 ? `<p><strong>Descuento:</strong> $${factura.discount.toFixed(2)}</p>` : ''}
            <p><strong>IVA (12%):</strong> $${factura.tax.toFixed(2)}</p>
            <p><strong>TOTAL:</strong> $${factura.total.toFixed(2)}</p>
        </div>

        ${factura.notes ? `
        <div class="notes-info">
            <h4>Observaciones</h4>
            <p>${factura.notes}</p>
        </div>
        ` : ''}
    `;

    modal.classList.add("active");
    document.body.style.overflow = 'hidden';
}

// Cerrar modal de detalle
function closeInvoiceDetailModal() {
    document.getElementById("invoiceDetailModal").classList.remove("active");
    document.body.style.overflow = 'auto';
}

// Cargar m√°s facturas
function loadMoreInvoices() {
    if (currentIndex >= invoices.length) {
        alert("No hay m√°s facturas disponibles üìë");
        return;
    }

    renderInvoices();
}

// Filtrar facturas
function aplicarFiltros() {
    const cliente = document.getElementById('clienteFilter').value.toLowerCase();
    const desde = document.getElementById('fechaInicio').value;
    const hasta = document.getElementById('fechaFin').value;

    let facturasFiltradas = invoices;

    // Filtrar por cliente
    if (cliente) {
        facturasFiltradas = facturasFiltradas.filter(factura => 
            factura.client.name.toLowerCase().includes(cliente) ||
            (factura.client.document && factura.client.document.includes(cliente))
        );
    }

    // Filtrar por fecha
    if (desde) {
        facturasFiltradas = facturasFiltradas.filter(factura => factura.date >= desde);
    }

    if (hasta) {
        facturasFiltradas = facturasFiltradas.filter(factura => factura.date <= hasta);
    }

    // Limpiar lista actual
    const invoiceList = document.getElementById("invoiceList");
    invoiceList.innerHTML = '';

    // Renderizar facturas filtradas
    if (facturasFiltradas.length === 0) {
        invoiceList.innerHTML = '<p>No se encontraron facturas que coincidan con los filtros aplicados.</p>';
        document.querySelector('.load-more-btn').style.display = 'none';
    } else {
        currentIndex = 0;
        renderInvoices(facturasFiltradas);
        document.querySelector('.load-more-btn').style.display = 'none';
    }
}

// Limpiar filtros
function limpiarFiltros() {
    document.getElementById('clienteFilter').value = '';
    document.getElementById('fechaInicio').value = '';
    document.getElementById('fechaFin').value = '';
    
    // Recargar todas las facturas
    const invoiceList = document.getElementById("invoiceList");
    invoiceList.innerHTML = '';
    currentIndex = 0;
    renderInvoices();
}

// Alternar filtros
function toggleFilter() {
    const filterSection = document.getElementById('filterSection');
    filterSection.style.display = (filterSection.style.display === 'none') ? 'block' : 'none';
}

// Inicializar la p√°gina de facturas
function initializeInvoicesPage() {
    loadInvoices();
    currentIndex = 0;
    
    const invoiceList = document.getElementById("invoiceList");
    invoiceList.innerHTML = '';

    if (invoices.length > 0) {
        renderInvoices();
    } else {
        invoiceList.innerHTML = '<p>No hay facturas disponibles. Crea tu primera factura.</p>';
        document.querySelector('.load-more-btn').style.display = 'none';
    }
}

// Recargar facturas (para actualizar despu√©s de crear nuevas)
function reloadInvoices() {
    loadInvoices();
    const invoiceList = document.getElementById("invoiceList");
    invoiceList.innerHTML = '';
    currentIndex = 0;
    initializeInvoicesPage();
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar solo si estamos en la p√°gina de facturas
    if (document.getElementById("invoiceList")) {
        initializeInvoicesPage();
    }

    // Cerrar modal al hacer clic fuera
    const modal = document.getElementById("invoiceDetailModal");
    if (modal) {
        modal.addEventListener('click', function(event) {
            if (event.target === modal) {
                closeInvoiceDetailModal();
            }
        });
    }

    // Cerrar modal con Escape
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && modal && modal.classList.contains('active')) {
            closeInvoiceDetailModal();
        }
    });
});

// Funci√≥n para refrescar la lista desde otras p√°ginas
function refreshInvoiceList() {
    if (document.getElementById("invoiceList")) {
        reloadInvoices();
    }
}
	</script>
</body>
</html>